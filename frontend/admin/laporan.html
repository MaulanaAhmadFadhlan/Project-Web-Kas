<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laporan Keuangan - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(to right, #e3f2fd, #f8fbff);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      font-family: 'Poppins', sans-serif;
    }
    .navbar { background-color: #1976d2; }
    .navbar-brand, .nav-link { color: white !important; }
    .card {
      border: none; border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .summary-box {
      border-radius: 12px; padding: 20px; text-align: center;
      color: white; box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }
    footer {
      margin-top: auto; background: #1976d2;
      color: white; text-align: center; padding: 12px;
    }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">Kas RT - Admin</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="anggota.html">Anggota</a></li>
          <li class="nav-item"><a class="nav-link" href="pemasukan.html">Pemasukan</a></li>
          <li class="nav-item"><a class="nav-link" href="pengeluaran.html">Pengeluaran</a></li>
          <li class="nav-item"><a class="nav-link active fw-bold" href="laporan.html">Laporan</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h2 class="text-center mb-4 fw-bold text-primary">Laporan Keuangan Kas RT</h2>

    <div class="card p-4 mb-4">
      <h4 class="fw-bold text-primary mb-3">Data Pemasukan</h4>
      <table class="table table-bordered table-hover text-center align-middle">
        <thead class="table-success">
          <tr><th>No</th><th>Tanggal</th><th>Nama</th><th>Keterangan</th><th>Jumlah (Rp)</th></tr>
        </thead>
        <tbody id="tabelPemasukan"></tbody>
      </table>
    </div>

    <div class="card p-4 mb-4">
      <h4 class="fw-bold text-primary mb-3">Data Pengeluaran</h4>
      <table class="table table-bordered table-hover text-center align-middle">
        <thead class="table-danger">
          <tr><th>No</th><th>Tanggal</th><th>Keterangan</th><th>Jumlah (Rp)</th></tr>
        </thead>
        <tbody id="tabelPengeluaran"></tbody>
      </table>
    </div>

    <div class="text-center">
      <button class="btn btn-primary px-4 py-2" onclick="window.open('../../backend/admin/laporan.php')">
        Unduh Laporan (PDF)
      </button>
    </div>
  </div>

  <footer><p>Â© 2025 Kas RT - Sistem Keuangan RT</p></footer>

  <script>
  async function formatRupiah(num) {
    return "Rp " + Number(num).toLocaleString("id-ID");
  }

  async function loadData() {
    try {
      const res = await fetch("../../backend/admin/laporan_data.php");
      const data = await res.json();

      let htmlMasuk = "", htmlKeluar = "";
      data.pemasukan.forEach((p, i) => {
        htmlMasuk += `<tr>
          <td>${i + 1}</td><td>${p.tanggal}</td>
          <td>${p.nama ?? '-'}</td><td>${p.keterangan}</td>
          <td>${formatRupiah(p.jumlah)}</td></tr>`;
      });
      data.pengeluaran.forEach((p, i) => {
        htmlKeluar += `<tr>
          <td>${i + 1}</td><td>${p.tanggal}</td>
          <td>${p.keterangan}</td><td>${formatRupiah(p.jumlah)}</td></tr>`;
      });

      document.getElementById("tabelPemasukan").innerHTML = htmlMasuk;
      document.getElementById("tabelPengeluaran").innerHTML = htmlKeluar;

      document.getElementById("totalPemasukan").innerText = await formatRupiah(data.total_pemasukan);
      document.getElementById("totalPengeluaran").innerText = await formatRupiah(data.total_pengeluaran);
      document.getElementById("saldoAkhir").innerText = await formatRupiah(data.saldo);
    } catch (err) {
      console.error("Gagal memuat data laporan:", err);
    }
  }
  loadData();
  </script>
</body>
</html>