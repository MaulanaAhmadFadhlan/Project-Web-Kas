<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Manajemen Admin - Kas RT</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { font-family: Poppins, sans-serif; background: #f8fbff; }
    .sidebar { width: 250px; background: #1d4ed8; min-height: 100vh; position: fixed; color: #fff; }
    .sidebar a { color: #fff; padding: 15px; display: block; text-decoration: none; }
    .sidebar a:hover, .active { background: #2563eb; }
    .main-content { margin-left: 250px; padding: 30px; }
    .card { border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: none; }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h4 class="text-center py-3">Kas RT</h4>
    <a href="dashboard.html">Dashboard</a>
    <a href="anggota.html">Data Anggota</a>
    <a href="pemasukan.html">Input Pemasukan</a>
    <a href="pengeluaran.html">Input Pengeluaran</a>
    <a href="laporan.html">Laporan</a>
    <a href="admin.html" class="active">Manajemen Admin</a>
  </div>

  <!-- Main Content -->
  <div class="main-content">

    <div class="d-flex justify-content-between mb-4">
      <h3 class="fw-bold">Manajemen Admin</h3>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalTambah">
        <i class="bi bi-plus-circle"></i> Tambah Admin
      </button>
    </div>

    <div class="card p-4">
      <table class="table table-bordered text-center">
        <thead class="table-primary">
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Password</th>
            <th>Level Akses</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tabelAdmin"></tbody>
      </table>
    </div>

  </div>


  <!-- Modal Tambah -->
  <div class="modal fade" id="modalTambah" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Tambah Admin Baru</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <form id="formTambah">
          <div class="modal-body">

            <div class="mb-3">
              <label>Username</label>
              <input type="text" name="username" class="form-control" required>
            </div>

            <div class="mb-3">
              <label>Password</label>
              <input type="password" name="password" class="form-control" required>
            </div>

            <div class="mb-3">
              <label>Level Akses</label>
              <select name="level" class="form-control" required>
                <option value="admin">Admin</option>
                <option value="superadmin">Superadmin</option>
              </select>
            </div>

          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="submit" class="btn btn-primary">Simpan</button>
          </div>
        </form>

      </div>
    </div>
  </div>


  <!-- Modal Edit -->
  <div class="modal fade" id="modalEdit" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header bg-warning">
          <h5 class="modal-title">Edit Admin</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <form id="formEdit">
          <div class="modal-body">

            <input type="hidden" id="edit_id" name="id">

            <div class="mb-3">
              <label>Username</label>
              <input type="text" id="edit_username" name="username" class="form-control" required>
            </div>

            <div class="mb-3">
              <label>Password</label>
              <input type="text" id="edit_password" name="password" class="form-control">
            </div>

            <div class="mb-3">
              <label>Level</label>
              <select id="edit_level" name="level" class="form-control" required>
                <option value="admin">Admin</option>
                <option value="superadmin">Superadmin</option>
              </select>
            </div>

          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="submit" class="btn btn-warning">Update</button>

          </div>
        </form>

      </div>
    </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- FULL FIXED CRUD SCRIPT -->
  <script>
const API = "/impal/Project-Web-Kas-main/BACKEND/admin/admin_crud.php";

/* =================== LOAD DATA =================== */
function loadAdmin(){
  fetch(API)
  .then(r => r.json())
  .then(res => {
    const t = document.getElementById("tabelAdmin");
    t.innerHTML = "";

    if (!res.success){
      t.innerHTML = `<tr><td colspan="5">Tidak ada data admin.</td></tr>`;
      return;
    }

    res.data.forEach(a => {
      t.innerHTML += `
        <tr>
          <td>${a.id}</td>
          <td>${a.username}</td>
          <td>${a.password}</td>
          <td>${a.level}</td>
          <td>
            <button class='btn btn-warning btn-sm' onclick='editAdmin(${a.id})'>
              <i class='bi bi-pencil'></i>
            </button>
            <button class='btn btn-danger btn-sm' onclick='hapusAdmin(${a.id})'>
              <i class='bi bi-trash'></i>
            </button>
          </td>
        </tr>`;
    });
  });
}
document.addEventListener("DOMContentLoaded", loadAdmin);


/* =================== TAMBAH ADMIN =================== */
document.getElementById("formTambah").addEventListener("submit", e => {
  e.preventDefault();

  let formData = new FormData(e.target);
  formData.append("aksi", "tambah");

  fetch(API, {
    method: "POST",
    body: formData
  })
  .then(r => r.json())
  .then(res => {
    alert(res.message);

    if(res.success){
      loadAdmin();
      e.target.reset();
      bootstrap.Modal.getInstance(document.getElementById("modalTambah")).hide();
    }
  });
});


/* =================== LOAD DATA UNTUK EDIT =================== */
function editAdmin(id){
  fetch(API + "?id=" + id)
  .then(r => r.json())
  .then(res => {
    let a = res.data;

    document.getElementById("edit_id").value = a.id;
    document.getElementById("edit_username").value = a.username;
    document.getElementById("edit_password").value = a.password;
    document.getElementById("edit_level").value = a.level;

    new bootstrap.Modal(document.getElementById("modalEdit")).show();
  });
}


/* =================== UPDATE ADMIN =================== */
document.getElementById("formEdit").addEventListener("submit", e => {
  e.preventDefault();

  let formData = new FormData(e.target);
  formData.append("aksi", "update");

  fetch(API, {
    method: "POST",
    body: formData
  })
  .then(r => r.json())
  .then(res => {
    alert(res.message);

    if(res.success){
      loadAdmin();
      bootstrap.Modal.getInstance(document.getElementById("modalEdit")).hide();
    }
  });
});


/* =================== HAPUS ADMIN =================== */
function hapusAdmin(id){
  if(!confirm("Hapus admin ini?")) return;

  let form = new FormData();
  form.append("aksi", "hapus");
  form.append("id", id);

  fetch(API, {
    method: "POST",
    body: form
  })
  .then(r => r.json())
  .then(res => {
    alert(res.message);
    if(res.success) loadAdmin();
  });
}
</script>

</body>
</html>